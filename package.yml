name        : golang
version     : 1.6.3
release     : 6
homepage    : http://golang.org
source      :
    - https://storage.googleapis.com/golang/go1.6.3.linux-amd64.tar.gz : cdde5e08530c0579255d6153b08fdb3b8e47caabbe717bc7bcd7561275a87aeb
    - https://storage.googleapis.com/golang/go1.6.3.src.tar.gz : 6326aeed5f86cf18f16d6dc831405614f855e2d416a91fd3fdc334f772345b00
license     : MIT
summary     : The Go programming language.
description : Go is an open source programming language that makes it easy to build simple, reliable, and efficient software.
autodep     : no
strip       : no
component   : programming
rundeps     :
    - glibc
replaces    :
    - golang-binary
build       : |
    # Set up the official binary into a bootstrap mode
    export GOROOT="$workdir"
    export GOPATH="$workdir"
    export GOROOT_BOOTSTRAP="$workdir"
    mkdir go_bootstrap
    pushd go_bootstrap

    # Extract the source tarball
    tar xf $sources/go${version}.src.tar.gz
    export GOROOT_FINAL="%libdir%/golang"
    pushd go

    # Patch build failures
    %patch -p1 < $pkgfiles/0001-os-test-Solus-uses-usr-bin-hostname-conform-and-don-.patch

    # Build and run test suites
    pushd src
    bash ./all.bash
    
    # Install into this working tree
    popd
    GOROOT=$(pwd) PATH=$(pwd)/bin:$PATH go install -buildmode=shared std
install : |
    cd $workdir/go_bootstrap/go
    mkdir -p $installdir/%libdir%/golang
    mkdir -p $installdir/usr/bin
    cp -a *  $installdir/%libdir%/golang
    ln -s %libdir%/golang/bin/go $installdir/usr/bin/go
    ln -s %libdir%/golang/bin/gofmt $installdir/usr/bin/gofmt
